<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RSVP Quiz â€“ 120 WPM</title>
<style>
  :root { --border:#e5e7eb; --bg:#f8fafc; --text:#0f172a; --muted:#64748b; --primary:#2563eb; }
  * { box-sizing:border-box; }
  body { font:16px/1.5 system-ui, Arial, sans-serif; background:#fff; color:var(--text); margin:0; }
  .wrap { max-width:800px; margin:30px auto; padding:20px; }
  .card { border:1px solid var(--border); border-radius:12px; padding:24px; }
  h1 { font-size:1.4rem; margin:0 0 12px; }
  .muted { color:var(--muted); }
  .display { font-size:2rem; text-align:center; min-height:100px; display:flex; align-items:center; justify-content:center; background:var(--bg); border-radius:10px; margin-bottom:20px; }
  fieldset { border:1px dashed var(--border); border-radius:10px; padding:14px; margin:0; }
  legend { padding:0 6px; font-weight:bold; }
  label { display:block; padding:6px 0; }
  .hidden { display:none; }
  .bar { height:6px; background:#e5e7eb; border-radius:999px; overflow:hidden; margin-top:12px; }
  .bar > i { display:block; height:100%; width:0%; background:var(--primary); transition:width 0.2s linear; }
  .controls { margin-top:20px; }
  button { padding:8px 14px; border:0; border-radius:8px; cursor:pointer; background:var(--primary); color:#fff; font-weight:600; }
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Reading Quiz (RSVP)</h1>
    <p class="muted">Each passage is shown word-by-word at <b>120 WPM</b>. Then 3 MCQs appear one-by-one for <b>15s</b> each.</p>

    <div class="display" id="displayBox"></div>
    <div class="bar"><i id="progressFill"></i></div>

    <div id="quizBox" class="hidden">
      <fieldset>
        <legend id="qLegend">Question</legend>
        <div id="qOptions"></div>
        <p class="muted" id="qTimer">Time left: 15s</p>
      </fieldset>
    </div>

    <div class="controls">
      <button id="startBtn">Start</button>
    </div>
  </div>
</div>

<script>
/** CONFIG */
const WPM = 120;
const WORD_INTERVAL_MS = Math.round(60000 / WPM); // 500ms
const QUESTION_DURATION_MS = 15000; // 15s

/** DATA */
const PASSAGES = [
  {
    title: "Passage A",
    text: "Before sunrise the team prepares their route carefully. Each driver checks fuel and tires while the coordinator confirms the delivery window. By organizing boxes and agreeing on alternate routes they avoid delays and improve efficiency.",
    questions: [
      { text:"What is the team doing?", options:["Preparing a route","Eating breakfast","Repairing engines"] },
      { text:"Why check fuel and tires?", options:["Ensure safety","Decorate truck","Save money"] },
      { text:"How do they avoid delays?", options:["Alternate routes","Cancel job","Ignore schedules"] }
    ]
  },
  {
    title: "Passage B",
    text: "In the afternoon volunteers guide students through the campus. They highlight offices study areas and the clinic. A group chat helps latecomers rejoin the tour and the walk ends at the library.",
    questions: [
      { text:"Who guides the students?", options:["Volunteers","Drivers","Teachers only"] },
      { text:"Where does the walk end?", options:["At the library","At the cafeteria","At the parking lot"] },
      { text:"What helps latecomers?", options:["A group chat","Printed maps","Announcements"] }
    ]
  }
];

/** STATE */
let passageIndex = 0, wordIndex = 0, words = [];
let readingTimer = null, quizTimer = null, quizRemaining = QUESTION_DURATION_MS;
let currentQuestionIndex = 0;

/** EL REFS */
const displayBox = document.getElementById('displayBox');
const progressFill = document.getElementById('progressFill');
const startBtn = document.getElementById('startBtn');
const quizBox = document.getElementById('quizBox');
const qLegend = document.getElementById('qLegend');
const qOptions = document.getElementById('qOptions');
const qTimer = document.getElementById('qTimer');

/** HELPERS */
function clearTimers() {
  if (readingTimer) { clearInterval(readingTimer); readingTimer=null; }
  if (quizTimer) { clearInterval(quizTimer); quizTimer=null; }
}
function renderWord() {
  if (wordIndex >= words.length) {
    clearInterval(readingTimer); readingTimer=null;
    // hide passage box when finished
    displayBox.classList.add('hidden');
    startQuizPhase();
    return;
  }
  displayBox.textContent = words[wordIndex++];
  progressFill.style.width = `${Math.round((wordIndex/words.length)*100)}%`;
}
function startReadingPhase() {
  const p = PASSAGES[passageIndex];
  words = p.text.trim().split(/\s+/);
  wordIndex = 0;
  displayBox.textContent = "";
  displayBox.classList.remove('hidden'); // show passage while reading
  quizBox.classList.add('hidden');
  progressFill.style.width = "0%";
  readingTimer = setInterval(renderWord, WORD_INTERVAL_MS);
}
function showQuestion(q) {
  qLegend.textContent = `Q${currentQuestionIndex+1}. ${q.text}`;
  qOptions.innerHTML = q.options.map(opt=>`<label><input type="radio" name="q${currentQuestionIndex}" value="${opt}"> ${opt}</label>`).join("");
  quizRemaining = QUESTION_DURATION_MS;
  updateQuizTimer();
}
function updateQuizTimer() {
  qTimer.textContent = `Time left: ${Math.ceil(quizRemaining/1000)}s`;
  progressFill.style.width = `${100 - Math.round((quizRemaining/QUESTION_DURATION_MS)*100)}%`;
}
function startQuizPhase() {
  const p = PASSAGES[passageIndex];
  currentQuestionIndex = 0;
  quizBox.classList.remove('hidden');
  showQuestion(p.questions[currentQuestionIndex]);
  quizTimer = setInterval(()=>{
    quizRemaining -= 1000;
    if (quizRemaining<=0) {
      clearInterval(quizTimer); quizTimer=null;
      if (currentQuestionIndex < p.questions.length-1) {
        currentQuestionIndex++;
        showQuestion(p.questions[currentQuestionIndex]);
        startQuizPhase(); // restart timer loop
      } else {
        // next passage
        passageIndex = (passageIndex+1) % PASSAGES.length;
        startReadingPhase();
      }
    } else {
      updateQuizTimer();
    }
  },1000);
}

/** EVENTS */
startBtn.addEventListener('click',()=>{
  clearTimers();
  passageIndex=0;
  startReadingPhase();
});
</script>
</body>
</html>
